{
  "name": "VERS√ÉO APIFY",
  "nodes": [
    {
      "parameters": {
        "jsCode": "// Prepara dados para o Gemini\nconst apifyData = $input.first().json;\nconst routerData = $('Roteador3').first().json;\nconst lead = Array.isArray(apifyData) ? apifyData[0] : apifyData;\n\n// Extrair @mentions da bio\nconst bio = lead?.biography || '';\nconst mentions = bio.match(/@[\\w.]+/g) || [];\n\n// Extrair URLs de posts recentes (at√© 5)\nconst posts = lead?.latestPosts || lead?.posts || [];\nconst postData = posts.slice(0, 5).map(p => ({\n  caption: p.caption || '',\n  likes: p.likesCount || 0,\n  comments: p.commentsCount || 0,\n  type: p.type || 'image',\n  url: p.displayUrl || p.url || ''\n}));\n\nreturn {\n  json: {\n    username: lead?.username || routerData?.username || '',\n    fullName: lead?.fullName || '',\n    biography: bio,\n    mentions: mentions,\n    followersCount: lead?.followersCount || 0,\n    followingCount: lead?.followingCount || 0,\n    postsCount: lead?.postsCount || 0,\n    profilePicUrl: lead?.profilePicUrlHD || lead?.profilePicUrl || '',\n    externalUrl: lead?.externalUrl || '',\n    businessCategory: lead?.businessCategoryName || '',\n    isBusinessAccount: lead?.isBusinessAccount || false,\n    isVerified: lead?.isVerified || false,\n    recentPosts: postData,\n    training_data: routerData.training_data || {}\n  }\n};"
      },
      "id": "3adeb6d8-e83a-47c5-aa71-5bed6b572669",
      "name": "Prepara Dados",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -384,
        -416
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=AIzaSyCIdRJ_f7F3PQ8Zaq8NWqEsv9Ld5r3ksm0",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{\n{\n  \"contents\": [\n    {\n      \"parts\": [\n        {\n          \"text\": `VOC√ä √â UM ESPECIALISTA EM SOCIAL SELLING DE ALTA CONVERS√ÉO.\n\nSUA MISS√ÉO: Analisar profundamente este lead do Instagram e criar uma estrat√©gia de abordagem √öNICA e PERSONALIZADA.\n\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n‚ñà EXPERT QUE VAI ABORDAR\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\nNome: ${$json.training_data?.userName || 'Expert'}\nNeg√≥cio: ${$json.training_data?.userBusiness || 'N√£o informado'}\nNicho: ${$json.training_data?.userNiche || 'N√£o informado'}\nTom de comunica√ß√£o: ${$json.training_data?.communicationTone || 'casual e direto'}\nEstilo de abordagem: ${$json.training_data?.approachStyle || 'direto'}\n\nüìã O QUE O EXPERT FAZ:\n${$json.training_data?.whatYouDo || 'N√£o informado'}\n\nüéÅ O QUE O EXPERT ENTREGA:\n${$json.training_data?.whatYouDeliver || 'N√£o informado'}\n\nüéØ PROBLEMA QUE RESOLVE:\n${$json.training_data?.problemYouSolve || 'N√£o informado'}\n\n‚≠ê METODOLOGIA/DIFERENCIAL:\n${$json.training_data?.yourMethodology || 'N√£o informado'}\n\nProposta de valor: ${$json.training_data?.valueProposition || 'N√£o informado'}\nP√∫blico-alvo: ${$json.training_data?.targetAudience || 'N√£o informado'}\nEvitar falar sobre: ${$json.training_data?.avoidTopics || 'Nada espec√≠fico'}\n\nEXEMPLOS DE MENSAGENS DO EXPERT (COPIE O ESTILO EXATO):\n${$json.training_data?.messageExamples || 'Nenhum exemplo - use tom direto e profissional'}\n\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n‚ñà DADOS DO LEAD A SER ABORDADO\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\nUsername: @${$json.username}\nNome: ${$json.fullName || 'N√£o informado'}\n\nBIO COMPLETA:\n\"${$json.biography || 'Sem bio'}\"\n\n@MENTIONS NA BIO (empresas/pessoas mencionadas):\n${JSON.stringify($json.mentions || [])}\n\nESTAT√çSTICAS:\n- Seguidores: ${$json.followersCount}\n- Seguindo: ${$json.followingCount}\n- Posts: ${$json.postsCount}\n- Categoria: ${$json.businessCategory || 'Pessoal'}\n- Conta business: ${$json.isBusinessAccount ? 'Sim' : 'N√£o'}\n- Verificado: ${$json.isVerified ? 'Sim' : 'N√£o'}\n- Website: ${$json.externalUrl || 'Nenhum'}\n\n√öLTIMOS POSTS/REELS (ANALISE O CONTE√öDO EM PROFUNDIDADE):\n${JSON.stringify($json.recentPosts || [])}\n\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n‚ñà AN√ÅLISE PROFUNDA REQUERIDA - EXTRAIA O M√ÅXIMO DE INTERESSES\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n‚ö†Ô∏è ATEN√á√ÉO: Voc√™ DEVE identificar pelo menos 3-5 interesses do lead. Analise:\n\n1. BIO: Profiss√£o, especializa√ß√£o, cargo, empresa, certifica√ß√µes, t√≠tulos\n2. CONTE√öDO DOS POSTS: Temas recorrentes, produtos mencionados, servi√ßos oferecidos\n3. ESTILO DE VIDA: Fam√≠lia, filhos, viagens, hobbies vis√≠veis nos posts\n4. VALORES: Religi√£o, causas sociais, cren√ßas manifestadas\n5. ESPECIALIDADES: Nichos de atua√ß√£o, p√∫blico-alvo, metodologias\n\nPara o exemplo de uma m√©dica nutr√≥loga com bio \"Refer√™ncia em Sa√∫de Feminina Integrativa | Da Fertilidade √† Menopausa | Crist√£ | Palestrante\", voc√™ deveria identificar:\n- Profiss√£o: M√©dica Nutr√≥loga\n- Especializa√ß√£o: Sa√∫de Feminina Integrativa\n- Foco: Fertilidade e Menopausa\n- Valores: Crist√£ (religi√£o)\n- Atividade: Palestrante e Escritora\n- Se posts mencionam Mounjaro: Tratamentos com medica√ß√µes modernas\n\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n‚ñà REGRAS ABSOLUTAS\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n‚ùå PROIBIDO:\n- Retornar lead_interests vazio (SEMPRE identifique algo)\n- Usar placeholders como [mencione algo]\n- \"Oi, tudo bem?\", \"Ol√°!\", \"Boa tarde!\"\n- Frases gen√©ricas\n\n‚úÖ OBRIGAT√ìRIO:\n- Retornar M√çNIMO 3 interesses identificados\n- Mensagens COMPLETAS e PRONTAS para copiar\n- Mencionar algo ESPEC√çFICO da bio ou posts\n- COPIAR o estilo dos exemplos de mensagens\n- Cada mensagem m√°ximo 3 linhas\n\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n‚ñà RESPOSTA (APENAS JSON V√ÅLIDO)\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n{\n  \"bio_analysis\": \"[An√°lise detalhada: profiss√£o, especializa√ß√£o, p√∫blico-alvo, valores, lifestyle]\",\n  \"lead_interests\": [\n    { \"category\": \"Profiss√£o\", \"detail\": \"[Cargo/√Årea exata do lead]\", \"conversation_starter\": \"[Gancho baseado na profiss√£o]\" },\n    { \"category\": \"Especializa√ß√£o\", \"detail\": \"[Nicho espec√≠fico de atua√ß√£o]\", \"conversation_starter\": \"[Como abordar sobre a especialidade]\" },\n    { \"category\": \"Conte√∫do\", \"detail\": \"[Tema principal dos posts]\", \"conversation_starter\": \"[Elogio ou pergunta sobre o conte√∫do]\" },\n    { \"category\": \"Valores\", \"detail\": \"[Cren√ßas, causas, religi√£o se mencionado]\", \"conversation_starter\": \"[Conex√£o respeitosa com valores]\" },\n    { \"category\": \"Fam√≠lia\", \"detail\": \"[Se mencionar filhos, c√¥njuge, etc]\", \"conversation_starter\": \"[Conex√£o pessoal se apropriado]\" },\n    { \"category\": \"Lifestyle\", \"detail\": \"[Hobbies, viagens, h√°bitos]\", \"conversation_starter\": \"[Interesse em comum]\" }\n  ],\n  \"content_analysis\": [\n    { \"post_type\": \"reel\", \"theme\": \"[Tema espec√≠fico]\", \"insight\": \"[O que revela sobre expertise/interesse]\", \"opportunity\": \"[Como usar na abordagem]\" }\n  ],\n  \"tactics\": [\n    { \"emoji\": \"üîç\", \"text\": \"[T√°tica espec√≠fica baseada na especializa√ß√£o do lead]\" },\n    { \"emoji\": \"üì±\", \"text\": \"[T√°tica baseada no conte√∫do dos posts]\" },\n    { \"emoji\": \"üéØ\", \"text\": \"[T√°tica conectando lead com expert]\" }\n  ],\n  \"messages\": [\n    { \"label\": \"Abertura\", \"text\": \"[MENSAGEM mencionando especializa√ß√£o/conte√∫do do lead]\" },\n    { \"label\": \"Qualifica√ß√£o\", \"text\": \"[MENSAGEM descobrindo se lead tem interesse no digital]\" },\n    { \"label\": \"Transi√ß√£o\", \"text\": \"[MENSAGEM conectando expertise do lead com oportunidade]\" },\n    { \"label\": \"Fechamento\", \"text\": \"[MENSAGEM com CTA para conversa]\" }\n  ],\n  \"ideas\": [\n    \"[Ideia baseada na ESPECIALIZA√á√ÉO do lead]\",\n    \"[Ideia baseada no CONTE√öDO dos posts]\",\n    \"[Ideia conectando lead expert com ${$json.training_data?.userBusiness || 'seu neg√≥cio'}]\"\n  ],\n  \"triggers\": [\n    { \"icon\": \"[emoji]\", \"title\": \"[Gatilho]\", \"text\": \"[Aplica√ß√£o espec√≠fica para este lead]\" }\n  ]\n}\n\n‚ö†Ô∏è CR√çTICO: N√ÉO deixe lead_interests vazio. Sempre identifique pelo menos 3 interesses baseados na bio e posts.`\n        }\n      ]\n    }\n  ],\n  \"generationConfig\": {\n    \"temperature\": 0.7,\n    \"maxOutputTokens\": 4000\n  }\n}\n}}",
        "options": {}
      },
      "id": "b5bbc417-c567-4e5c-9994-e97d7376adba",
      "name": "Gemini Vision",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -160,
        -416
      ]
    },
    {
      "parameters": {
        "jsCode": "const geminiResponse = $input.first().json;\nconst leadData = $('Prepara Dados').first().json;\n\nlet content = '';\nif (geminiResponse.candidates && geminiResponse.candidates[0]?.content?.parts?.[0]?.text) {\n  content = geminiResponse.candidates[0].content.parts[0].text;\n}\n\nlet parsed = { tactics: [], messages: [], ideas: [], triggers: [], bio_analysis: '', lead_interests: [], content_analysis: [] };\ntry {\n  // Extract JSON from response\n  const match = content.match(/\\{[\\s\\S]*\\}/);\n  if (match) {\n    parsed = JSON.parse(match[0]);\n  }\n} catch (e) {\n  console.log('Parse error:', e.message);\n  console.log('Content:', content);\n}\n\n// Map recent posts to carousel format\nconst recentPosts = (leadData.recentPosts || []).map((post, index) => {\n  const isVideo = post.type === 'Video' || post.type === 'video';\n  const caption = post.caption || '';\n  const summary = caption.length > 100 ? caption.substring(0, 100) + '...' : caption;\n  \n  // Get content analysis for this post if available\n  const postAnalysis = (parsed.content_analysis || [])[index] || {};\n  \n  return {\n    type: isVideo ? 'reel' : 'post',\n    thumbnail: post.url || '',\n    caption: caption,\n    summary: summary,\n    likes: post.likes || 0,\n    comments: post.comments || 0,\n    engagement: (post.likes || 0) + (post.comments || 0),\n    theme: postAnalysis.theme || summary.substring(0, 30) || 'Conte√∫do do perfil',\n    insight: postAnalysis.insight || '',\n    opportunity: postAnalysis.opportunity || '',\n    isVideo: isVideo\n  };\n});\n\nreturn {\n  json: {\n    status: \"success\",\n    profile: {\n      username: leadData.username || '',\n      full_name: leadData.fullName || '',\n      profile_pic: leadData.profilePicUrl || '',\n      bio: leadData.biography || '',\n      following: leadData.followingCount || 0,\n      followers: leadData.followersCount || 0,\n      posts: leadData.postsCount || 0,\n      website: leadData.externalUrl || '',\n      category: leadData.businessCategory || ''\n    },\n    bio_analysis: parsed.bio_analysis || '',\n    lead_interests: parsed.lead_interests || [],\n    content_analysis: parsed.content_analysis || [],\n    tactics: parsed.tactics || [],\n    messages: parsed.messages || [],\n    ideas: parsed.ideas || [],\n    triggers: parsed.triggers || [],\n    mentions_found: leadData.mentions || [],\n    recent_posts: recentPosts,\n    posts_analyzed: recentPosts.length\n  }\n};"
      },
      "id": "a6e21e6e-f3a7-45c2-8f2f-d203020d93c3",
      "name": "Parse Resposta",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        64,
        -416
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=AIzaSyCIdRJ_f7F3PQ8Zaq8NWqEsv9Ld5r3ksm0",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"contents\": [\n    {\n      \"parts\": [\n        {\n          \"text\": \"Voc√™ √© {{ $json.training_data.userName || 'um expert' }}.\\n\\nSeu tom: {{ $json.training_data.communicationTone || 'casual' }}\\n\\nExemplos das suas mensagens:\\n{{ $json.training_data.messageExamples || 'Use tom profissional' }}\\n\\nHist√≥rico:\\n{{ $json.conversation_history || 'In√≠cio' }}\\n\\nO lead respondeu:\\n\\\"{{ $json.lead_response }}\\\"\\n\\nEscreva a PR√ìXIMA MENSAGEM (m√°x 3 linhas) no seu estilo.\\n\\nJSON apenas:\\n{\\n  \\\"follow_up_message\\\": \\\"[SUA MENSAGEM]\\\",\\n  \\\"tips\\\": \\\"[DICA R√ÅPIDA]\\\"\\n}\"\n        }\n      ]\n    }\n  ],\n  \"generationConfig\": {\n    \"temperature\": 0.7,\n    \"maxOutputTokens\": 500\n  }\n}",
        "options": {}
      },
      "id": "b5832c16-2000-48e6-8077-930d4990597d",
      "name": "Gemini Follow-up",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -608,
        -208
      ]
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "social-selling",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "fba1a58c-9f6b-4d76-b2d4-bafb528fca23",
      "name": "Webhook3",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -1264,
        -304
      ],
      "webhookId": "social-selling-gemini"
    },
    {
      "parameters": {
        "jsCode": "const body = $input.first().json.body;\nconst action = body.action || 'analyze';\n\nif (action === 'follow_up') {\n  return {\n    json: {\n      route: 'follow_up',\n      lead_response: body.lead_response || '',\n      conversation_history: body.conversation_history || '',\n      training_data: body.training_data || {},\n      lead_profile: body.lead_profile || {},\n      username: body.username || ''\n    }\n  };\n} else {\n  return {\n    json: {\n      route: 'analyze',\n      username: body.username || '',\n      training_data: body.training_data || {}\n    }\n  };\n}"
      },
      "id": "27f0a196-5095-467b-b6ea-0fe80ab95ce7",
      "name": "Roteador3",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1056,
        -304
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "route-check",
              "leftValue": "={{ $json.route }}",
              "rightValue": "follow_up",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "9e7b4d24-e6d6-4316-bdd8-ccc09c123ed9",
      "name": "√â Follow-up?3",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        -816,
        -304
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://api.apify.com/v2/acts/apify~instagram-profile-scraper/run-sync-get-dataset-items?token=YOUR_APIFY_TOKEN_HERE",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"usernames\": [\"{{ $json.username }}\"],\n  \"resultsLimit\": 15\n}",
        "options": {
          "timeout": 120000
        }
      },
      "id": "cc93c557-bb49-4df9-ae01-668689257482",
      "name": "Apify Scraper3",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -608,
        -416
      ]
    },
    {
      "parameters": {
        "jsCode": "const geminiResponse = $input.first().json;\n\nlet content = '';\nif (geminiResponse.candidates && geminiResponse.candidates[0]?.content?.parts?.[0]?.text) {\n  content = geminiResponse.candidates[0].content.parts[0].text;\n}\n\nlet parsed = {};\ntry {\n  const match = content.match(/\\{[\\s\\S]*\\}/);\n  if (match) {\n    parsed = JSON.parse(match[0]);\n  }\n} catch (e) {\n  parsed = {\n    follow_up_message: \"Me conta mais sobre isso!\",\n    tips: \"Resposta de fallback\"\n  };\n}\n\nreturn {\n  json: {\n    follow_up_message: parsed.follow_up_message || \"Me conta mais!\",\n    tips: parsed.tips || \"\"\n  }\n};"
      },
      "id": "7f13449e-c7f4-4b1e-b76e-11e205fa1a16",
      "name": "Parse Follow-up3",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -384,
        -208
      ]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Access-Control-Allow-Origin",
                "value": "*"
              }
            ]
          }
        }
      },
      "id": "037df5b2-5fef-4b74-8211-e9b2b41f5284",
      "name": "Responder An√°lise3",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        272,
        -416
      ]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Access-Control-Allow-Origin",
                "value": "*"
              }
            ]
          }
        }
      },
      "id": "59137eb0-a1f2-4b63-8f06-862e38498bd5",
      "name": "Responder Follow-up3",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        -160,
        -208
      ]
    }
  ],
  "pinData": {},
  "connections": {
    "Prepara Dados": {
      "main": [
        [
          {
            "node": "Gemini Vision",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gemini Vision": {
      "main": [
        [
          {
            "node": "Parse Resposta",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Resposta": {
      "main": [
        [
          {
            "node": "Responder An√°lise3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gemini Follow-up": {
      "main": [
        [
          {
            "node": "Parse Follow-up3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook3": {
      "main": [
        [
          {
            "node": "Roteador3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Roteador3": {
      "main": [
        [
          {
            "node": "√â Follow-up?3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "√â Follow-up?3": {
      "main": [
        [
          {
            "node": "Gemini Follow-up",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Apify Scraper3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Apify Scraper3": {
      "main": [
        [
          {
            "node": "Prepara Dados",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Follow-up3": {
      "main": [
        [
          {
            "node": "Responder Follow-up3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "15f4eacb-cd34-4df5-990e-e90588fd4c0a",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "dfc28cb9f3df5f53a428daf4180246203426f3d36b8c01d743e9be1152f2e632"
  },
  "id": "8qLUyTeGur4DBfYs",
  "tags": []
}